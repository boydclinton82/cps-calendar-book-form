---
phase: 06-code-extraction
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/06-code-extraction/extracted-code/
  - .planning/phases/06-code-extraction/DEPENDENCIES.json
  - knip.json
autonomous: true

must_haves:
  truths:
    - "All active source files are copied to extracted-code/ with dead code removed"
    - "No files from /versions/v1 are included in extraction"
    - "Dependency relationships between modules are documented"
  artifacts:
    - path: ".planning/phases/06-code-extraction/extracted-code/src/App.jsx"
      provides: "Clean App component without dead code"
    - path: ".planning/phases/06-code-extraction/extracted-code/api/bookings/index.js"
      provides: "Clean API endpoint"
    - path: ".planning/phases/06-code-extraction/DEPENDENCIES.json"
      provides: "Module dependency graph"
  key_links:
    - from: "knip.json"
      to: "dead code detection output"
      via: "Knip analysis"
      pattern: "entry.*main\\.jsx"
---

<objective>
Extract all active source files into a clean reference directory with dead code removed and dependency graph generated.

Purpose: Create the clean codebase reference that CODE-01 requires. This is the foundation for the manifest (Plan 02) and annotations (Plan 03).
Output: extracted-code/ directory with all active source files, DEPENDENCIES.json with module relationships.
</objective>

<execution_context>
@/Users/clintonweekes/.claude/get-shit-done/workflows/execute-plan.md
@/Users/clintonweekes/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-code-extraction/06-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run dead code analysis with Knip</name>
  <files>knip.json</files>
  <action>
Install Knip and madge as dev dependencies:
```
npm install --save-dev knip madge
```

Create knip.json in project root with this configuration:
```json
{
  "entry": ["src/main.jsx", "api/**/*.js"],
  "project": ["src/**/*.{js,jsx}", "api/**/*.js"],
  "ignore": ["versions/**", "dist/**", "scripts/**", "node_modules/**"],
  "ignoreDependencies": ["@vitejs/plugin-react"]
}
```

Run `npx knip` and capture the output. This identifies:
- Unused files (files not reachable from entry points)
- Unused exports (exported functions/variables not imported anywhere)
- Unused dependencies (npm packages not referenced)

Also run `npx madge --json --exclude 'node_modules' --extensions js,jsx src/main.jsx` to generate a dependency graph JSON.

Save the dependency graph output to `.planning/phases/06-code-extraction/DEPENDENCIES.json`.

Run `npx madge --circular src/` to check for circular dependencies. Log the result.

IMPORTANT: Do NOT include anything from the `/versions/` directory. The knip.json ignore pattern handles this.
  </action>
  <verify>
- `npx knip` runs without errors
- `cat .planning/phases/06-code-extraction/DEPENDENCIES.json` shows valid JSON with module relationships
- `npx madge --circular src/` reports results (ideally no circular deps)
  </verify>
  <done>Dead code analysis complete with Knip output reviewed, dependency graph saved as JSON, circular dependency check done.</done>
</task>

<task type="auto">
  <name>Task 2: Extract clean source files to reference directory</name>
  <files>.planning/phases/06-code-extraction/extracted-code/</files>
  <action>
Create the extraction directory structure:
```
.planning/phases/06-code-extraction/extracted-code/
├── src/
│   ├── components/     (all .jsx and .css files)
│   ├── hooks/          (all .js files)
│   ├── utils/          (all .js files)
│   ├── services/       (all .js files)
│   ├── context/        (all .jsx files)
│   ├── App.jsx
│   ├── App.css
│   ├── index.css
│   └── main.jsx
├── api/
│   ├── _lib/security.js
│   ├── bookings/index.js
│   ├── bookings/update.js
│   └── config.js
└── styles-note.md      (explains CSS is "visual reference only")
```

For each file:
1. Copy the file content from the active codebase
2. Review Knip output from Task 1 — if Knip flagged specific unused exports in a file, remove those exports from the extracted copy
3. Remove any commented-out code blocks (old implementations, TODOs from past features)
4. Remove unused imports that reference removed exports
5. Keep all active code exactly as-is (do not refactor or restructure)

Create `styles-note.md` with content:
```
# CSS Files - Visual Reference Only

The CSS files in this extraction are included for visual reference.
The Rails implementation will use its own styling approach (likely Tailwind or Rails asset pipeline).

These files document:
- Color values and theme (dark theme with cyan/orange accents)
- Spacing and layout patterns
- Responsive breakpoints (375px, 768px, 1440px)
- Animation/transition definitions

Do NOT port CSS syntax. Use these as a visual specification alongside the annotated screenshots from Phase 5.
```

CRITICAL EXCLUSIONS:
- Do NOT include anything from /versions/v1/
- Do NOT include build config (vite.config.js, package.json) — those are React/Vite specific
- Do NOT include test files, scripts/, or .env files
  </action>
  <verify>
- `ls -R .planning/phases/06-code-extraction/extracted-code/` shows the expected directory structure
- `find .planning/phases/06-code-extraction/extracted-code/ -name "*.jsx" -o -name "*.js" -o -name "*.css" | wc -l` shows the expected file count (should be ~36 files: 22 src + 10 CSS + 4 API)
- No files from /versions/ present: `find .planning/phases/06-code-extraction/extracted-code/ -path "*/v1/*" | wc -l` returns 0
- Diff spot-check: Compare a key file (e.g., useBookings.js) between original and extracted — should be identical or have only dead code removed
  </verify>
  <done>All active source files extracted to clean reference directory with dead code removed. No /versions/v1 code included. CSS files marked as visual reference only.</done>
</task>

</tasks>

<verification>
1. Run `find .planning/phases/06-code-extraction/extracted-code/ -type f | wc -l` — should be ~37 files (36 source + styles-note.md)
2. DEPENDENCIES.json exists and contains valid JSON
3. No /versions/ content in extracted directory
4. Knip output reviewed and any flagged dead code removed from extracted copies
</verification>

<success_criteria>
- extracted-code/ directory contains all active source files organized by category
- Dead code identified by Knip is removed from extracted copies
- DEPENDENCIES.json documents module relationships
- No old version code (/versions/v1) is included
- CSS files present but clearly marked as visual reference only
</success_criteria>

<output>
After completion, create `.planning/phases/06-code-extraction/06-01-SUMMARY.md`
</output>
