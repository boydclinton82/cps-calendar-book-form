---
phase: 06-code-extraction
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - .planning/phases/06-code-extraction/FILE-MANIFEST.md
autonomous: true

must_haves:
  truths:
    - "Every extracted file has a documented purpose, key functions, and dependencies"
    - "File manifest maps visual elements to their implementing code files"
    - "Data structures (booking, slot, config) are explicitly defined with field types and constraints"
  artifacts:
    - path: ".planning/phases/06-code-extraction/FILE-MANIFEST.md"
      provides: "Comprehensive file and function inventory"
      min_lines: 200
  key_links:
    - from: "FILE-MANIFEST.md"
      to: "extracted-code/ files"
      via: "file path references"
      pattern: "src/.*\\.(jsx|js)"
    - from: "FILE-MANIFEST.md"
      to: "Phase 5 screenshots"
      via: "screenshot cross-references"
      pattern: "screenshots/"
---

<objective>
Create FILE-MANIFEST.md documenting the purpose, functions, dependencies, and data structures of every extracted file.

Purpose: CODE-02 requires a file manifest so the Rails Claude knows what each file does without reading every line. This is the "table of contents" for the extracted code.
Output: FILE-MANIFEST.md with entries for all ~36 files, cross-referenced to Phase 5 screenshots.
</objective>

<execution_context>
@/Users/clintonweekes/.claude/get-shit-done/workflows/execute-plan.md
@/Users/clintonweekes/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-code-extraction/06-RESEARCH.md
@.planning/phases/06-code-extraction/06-01-SUMMARY.md
@.planning/phases/05-visual-capture/SCREENSHOT-MANIFEST.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Document core logic files (hooks, utils, services, API)</name>
  <files>.planning/phases/06-code-extraction/FILE-MANIFEST.md</files>
  <action>
Create FILE-MANIFEST.md in the phase directory. Start with the header and data structures section, then document each core logic file.

**Header:**
```markdown
# File Manifest: CPS Calendar Book Form

**Source:** Extracted from React 18 + Vite 6 + Vercel Serverless codebase
**Purpose:** Index for Rails Claude to understand what each file does
**Cross-references:** Phase 5 screenshots in `.planning/phases/05-visual-capture/screenshots/`

## How to Use This Manifest

1. Start with Data Structures to understand the domain objects
2. Read Core Logic files (hooks, utils, services) for business rules
3. Read API Endpoints for server contract
4. Skim Components for UI structure (but rely on Phase 5 screenshots for visual truth)
5. CSS files are visual reference only — do not port syntax
```

**Data Structures section:**
Document ALL data structures explicitly. Read the extracted code to identify every object shape used:
- Booking object: fields, types, constraints
- Slot status: possible values, what determines each
- Config object: fields, where they come from
- Date/time formats: key formats used throughout (dateKey, timeKey, etc.)
- User list: how users are configured

For each data structure, include field name, type, constraints, and example value.

**Core logic files to document (read each from extracted-code/):**
- `src/hooks/useBookings.js` — booking state management, slot status, CRUD operations
- `src/hooks/useKeyboard.js` — keyboard shortcut handling, conditional hotkeys
- `src/hooks/usePollingSync.js` — server polling for real-time sync
- `src/hooks/useConfig.js` — instance configuration loading
- `src/hooks/useHourlyRefresh.js` — hourly timer for slot refresh
- `src/utils/time.js` — time calculations, formatting, timezone handling
- `src/utils/storage.js` — storage abstraction (Vercel KV interface)
- `src/utils/colors.js` — user color assignments
- `src/services/api.js` — HTTP client for API calls
- `src/context/ConfigContext.jsx` — React context for config (document as "global config provider")
- `api/config.js` — config API endpoint
- `api/bookings/index.js` — bookings GET/POST endpoint
- `api/bookings/update.js` — booking update/delete endpoint
- `api/_lib/security.js` — request validation, rate limiting

For each file, document using this template:
```markdown
### path/to/file.ext

**Category:** [Pure utility | Business logic | API endpoint | Storage abstraction | ...]
**Purpose:** [One sentence]
**Dependencies:** [What this file imports]
**Used by:** [What files import this]

#### Key Functions

##### `functionName(param1, param2) -> returnType`
**Purpose:** [What it does]
**Behavior:** [Technology-neutral description of the logic]
**Edge cases:** [Any special handling]

#### Technology-Neutral Notes
[What a Rails developer needs to know about this file's concerns]
```

For API endpoints, additionally document:
- HTTP method(s)
- Request format (params, body, headers)
- Response format (status codes, body shape)
- Error cases
- Example request/response

Document storage functions as an abstract interface:
```
getBookings(dateKey) -> { [timeKey]: Booking }
saveBooking(dateKey, timeKey, booking) -> void
deleteBooking(dateKey, timeKey) -> void
```
  </action>
  <verify>
- FILE-MANIFEST.md exists and has entries for all core logic files (14 files)
- Data structures section defines all domain objects with field types
- API endpoints include request/response documentation
- Storage documented as abstract interface
  </verify>
  <done>Core logic files (hooks, utils, services, API, context) fully documented with functions, behaviors, and data structures.</done>
</task>

<task type="auto">
  <name>Task 2: Document component files and add screenshot cross-references</name>
  <files>.planning/phases/06-code-extraction/FILE-MANIFEST.md</files>
  <action>
Append to FILE-MANIFEST.md the component documentation and screenshot cross-references.

**Components to document (read each from extracted-code/):**
- `src/App.jsx` — main orchestrator (state management, event handling, layout)
- `src/main.jsx` — entry point
- `src/components/Header.jsx` — header bar with Book Now, timezone toggle, navigation
- `src/components/TimeStrip.jsx` — time slot grid container
- `src/components/TimeSlot.jsx` — individual time slot cell
- `src/components/BookingPanel.jsx` — side panel for booking flow (who + duration)
- `src/components/BookingPopup.jsx` — booking details popup on hover/click
- `src/components/BookingBlock.jsx` — visual block for booked slots
- `src/components/BookingOverlay.jsx` — overlay for booking interactions
- `src/components/WeekView.jsx` — weekly calendar grid
- `src/components/WeekBookingBlock.jsx` — booking block in week view
- `src/components/WeekDayOverlay.jsx` — day overlay in week view

For each component, document:
```markdown
### src/components/ComponentName.jsx

**Category:** UI component
**Purpose:** [One sentence]
**Visual reference:** [Screenshot file(s) from Phase 5 that show this component]
**Dependencies:** [Imports]
**Props/inputs:** [What data this component receives — describe as "parameters" not "props"]

#### Behavior
[What this component renders and how it responds to interaction]

#### States
[Different visual states this component can be in]
```

**Screenshot cross-references:** Map each component to the relevant Phase 5 screenshots:
- Header.jsx -> 01-initial-states/000-initial-load.png, 04-book-now-button/001-book-now-visible.png, 05-timezone-toggle/
- TimeStrip.jsx + TimeSlot.jsx -> 01-initial-states/001-empty-calendar-full-day.png, 02-slot-states/
- BookingPanel.jsx -> 01-initial-states/002-date-selected-with-panel.png, 03-booking-flow/
- BookingPopup.jsx -> 02-slot-states/002-slot-booked-and-blocked.png
- BookingBlock.jsx -> 02-slot-states/005-multi-hour-booking-block.png
- WeekView.jsx -> (check if week view screenshots exist in Phase 5)
- App.jsx -> 06-responsive/ (layout orchestration)

Also use the SCREENSHOT-MANIFEST.md from Phase 5 to ensure accurate cross-references.

**CSS files:** Add a brief section listing all CSS files with the note that they are visual reference only. No per-function documentation needed for CSS — just list the file and what component it styles.

**Add a summary table** at the end of FILE-MANIFEST.md:

```markdown
## File Summary

| File | Category | Lines | Key Concern |
|------|----------|-------|-------------|
| src/App.jsx | Orchestrator | ~400 | State management, event routing |
| src/hooks/useBookings.js | Business logic | ~241 | Booking CRUD, slot status |
| ... | ... | ... | ... |
```
  </action>
  <verify>
- FILE-MANIFEST.md has entries for all component files (12 files)
- Screenshot cross-references present for major components
- CSS files listed with "visual reference only" note
- Summary table at bottom covers all ~36 files
- `wc -l .planning/phases/06-code-extraction/FILE-MANIFEST.md` shows 200+ lines
  </verify>
  <done>All files documented in manifest. Components include screenshot cross-references. Summary table provides quick overview of entire codebase.</done>
</task>

</tasks>

<verification>
1. FILE-MANIFEST.md covers all files in extracted-code/
2. Data structures section defines Booking, Slot, Config objects with field types
3. API endpoints documented with request/response formats
4. Storage layer documented as abstract interface
5. Screenshot cross-references connect code to visual captures
6. Summary table at bottom lists all files
</verification>

<success_criteria>
- FILE-MANIFEST.md is a complete index of the extracted codebase
- A Rails developer (or Claude) reading only FILE-MANIFEST.md can understand the purpose of every file without reading the code
- Data structures are explicitly defined (no implicit shapes)
- API contracts are clear with request/response examples
- Visual elements linked back to Phase 5 screenshots
</success_criteria>

<output>
After completion, create `.planning/phases/06-code-extraction/06-02-SUMMARY.md`
</output>
