---
phase: 01-time-slot-fix
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/utils/time.js
autonomous: false

must_haves:
  truths:
    - "At 9:01, the 9:00 slot is still visible and bookable"
    - "At 9:59, the 9:00 slot is still visible and bookable"
    - "At 10:00, the 9:00 slot becomes past/greyed out"
    - "User can book the current hour slot at any point during that hour"
  artifacts:
    - path: "src/utils/time.js"
      provides: "isSlotPast function with corrected end-of-hour logic"
      contains: "hour + 1"
  key_links:
    - from: "src/App.jsx"
      to: "isSlotPast"
      via: "import and filter call"
      pattern: "isSlotPast\\(currentDate, slot\\.hour\\)"
    - from: "src/components/TimeSlot.jsx"
      to: "isSlotPast"
      via: "isPast determination"
      pattern: "isPast = isSlotPast\\(date, hour\\)"
---

<objective>
Fix the isSlotPast() function so time slots remain visible and bookable until the hour fully elapses.

Purpose: Currently, at 9:01am the 9:00 slot disappears because the function checks if the slot START time is past. Users lose the ability to book the current hour just one minute into it.

Output: Corrected time.js where slots remain bookable until the next hour begins.
</objective>

<execution_context>
@/Users/clintonweekes/.claude/get-shit-done/workflows/execute-plan.md
@/Users/clintonweekes/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/utils/time.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix isSlotPast() to check hour END instead of START</name>
  <files>src/utils/time.js</files>
  <action>
Modify the isSlotPast() function (lines 49-54) to compare against the slot END time instead of START time.

Current (buggy) logic:
```javascript
export function isSlotPast(date, hour) {
  const now = new Date();
  const slotDate = new Date(date);
  slotDate.setHours(hour, 0, 0, 0);  // Sets to start of hour
  return slotDate < now;  // True at 9:01 for 9:00 slot
}
```

Fixed logic:
```javascript
export function isSlotPast(date, hour) {
  const now = new Date();
  const slotEnd = new Date(date);
  slotEnd.setHours(hour + 1, 0, 0, 0);  // Sets to END of hour (start of next hour)
  return slotEnd <= now;  // True only at 10:00 for 9:00 slot
}
```

Key changes:
1. Rename `slotDate` to `slotEnd` for clarity
2. Use `hour + 1` instead of `hour` to represent the slot END time
3. Use `<=` instead of `<` so the slot becomes past exactly when the next hour starts

Note: This also correctly handles the 21:00 slot (END_HOUR - 1). At 22:00, the 21:00 slot becomes past. The hour + 1 = 22, and 22:00 <= 22:00 is true.
  </action>
  <verify>
Run `npm run build` to ensure no syntax errors. The build should complete successfully.
  </verify>
  <done>
isSlotPast() returns false for the current hour until the next hour begins. The fix uses slot END time (hour + 1) with <= comparison.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify current hour slot visibility</name>
  <what-built>Fixed isSlotPast() function that keeps current hour visible until the hour fully elapses</what-built>
  <how-to-verify>
1. Run `npm run dev` to start the development server
2. Open the app in browser (usually http://localhost:5173)
3. Navigate to TODAY's date
4. Check the current time and verify:
   - If it's currently 9:30am, the 9:00 AM slot should be visible and bookable (not greyed out)
   - The 8:00 AM slot (previous hour) should be greyed out / not visible
   - Future slots should all be visible
5. Try clicking the current hour slot to confirm booking panel opens
6. (Optional) If you can wait until the next hour starts, verify the current slot becomes past exactly at :00
  </how-to-verify>
  <resume-signal>Type "approved" if current hour slot is visible and bookable, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
- npm run build completes without errors
- Current hour slot visible when viewing today
- Current hour slot can be clicked to open booking panel
- Previous hours are correctly shown as past
</verification>

<success_criteria>
- isSlotPast(today, currentHour) returns false at any minute within the current hour
- isSlotPast(today, currentHour) returns true only when next hour begins
- All 5 consumers of isSlotPast() (App.jsx, WeekView.jsx, TimeStrip.jsx, TimeSlot.jsx, BookingBlock.jsx) benefit from the fix without code changes
</success_criteria>

<output>
After completion, create `.planning/phases/01-time-slot-fix/01-01-SUMMARY.md`
</output>
