---
phase: 05-visual-capture
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - .planning/phases/05-visual-capture/scripts/annotate.mjs
  - .planning/phases/05-visual-capture/screenshots/07-annotated/
autonomous: false

must_haves:
  truths:
    - "Every raw screenshot has a corresponding annotated version with red text labels identifying interactive elements"
    - "Annotations describe what each UI element is and what state it represents"
    - "Annotated screenshots are in a separate 07-annotated/ directory preserving originals"
    - "A screenshot manifest exists listing every image with its requirement ID and description"
  artifacts:
    - path: ".planning/phases/05-visual-capture/scripts/annotate.mjs"
      provides: "Annotation script using Sharp SVG composites to add text labels to screenshots"
    - path: ".planning/phases/05-visual-capture/screenshots/07-annotated/"
      provides: "All annotated screenshot PNGs with red text overlays"
    - path: ".planning/phases/05-visual-capture/SCREENSHOT-MANIFEST.md"
      provides: "Index of all screenshots with requirement mapping and descriptions"
  key_links:
    - from: "scripts/annotate.mjs"
      to: "screenshots/01-initial-states/ through 06-responsive/"
      via: "Sharp image.composite() with SVG text overlays"
      pattern: "sharp.*composite.*svg"
    - from: "SCREENSHOT-MANIFEST.md"
      to: "screenshots/"
      via: "File path references with VCAP-XX requirement IDs"
      pattern: "VCAP-0[1-8]"
---

<objective>
Annotate all raw screenshots with descriptive text labels and create a manifest document mapping every image to its requirement.

Purpose: Raw screenshots show visual truth but an AI consumer needs labels explaining what each element is and what state is shown. Annotations make the screenshots self-documenting. The manifest provides the structured index that ties everything together.

Output: Annotated versions of all screenshots in `07-annotated/`, plus `SCREENSHOT-MANIFEST.md` mapping every image to its VCAP requirement and description.
</objective>

<execution_context>
@/Users/clintonweekes/.claude/get-shit-done/workflows/execute-plan.md
@/Users/clintonweekes/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-visual-capture/05-RESEARCH.md
@.planning/phases/05-visual-capture/05-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create annotation script and annotate all screenshots</name>
  <files>
    .planning/phases/05-visual-capture/scripts/annotate.mjs
    .planning/phases/05-visual-capture/screenshots/07-annotated/
  </files>
  <action>
    Create `annotate.mjs` that reads all raw screenshots from directories 01-06 and produces annotated versions in `07-annotated/`.

    **Annotation style guide (consistent across all images):**
    - Font: Arial, 18px bold
    - Color: Red (#FF0000) with black drop shadow for readability on dark backgrounds
    - Position: Labels placed near the element they describe, avoiding overlap with critical UI
    - Format: "[Element Name] — [State Description]" (e.g., "Book Now Button — visible, current hour available")
    - Background: Semi-transparent dark rectangle behind each label for readability

    **Annotation approach:**
    Use Sharp's SVG composite feature. For each screenshot, define an array of annotation objects:
    ```
    { x: number, y: number, text: string }
    ```

    The annotations are HARDCODED per screenshot (not auto-detected). Define annotation maps keyed by filename. This is manual but precise — the AI consumer needs accurate labels, not guesses.

    **Annotation definitions per category:**

    For `01-initial-states/`:
    - `000-initial-load.png`: Labels for "Header — title, navigation, action buttons", "Calendar/Time Strip — current day view", "Date Navigation — left/right arrows"
    - `001-empty-calendar-full-day.png`: Labels for "Time Slot Grid — 16 slots (6AM-10PM)", "Available Slot — clickable, green-ish", "Header Navigation — date display with arrows"
    - `002-date-selected-with-panel.png`: Labels for "Booking Panel — slides in from right", "Selected Slot — highlighted", "User Selection — hotkey buttons", "Duration Selection — hour options"

    For `02-slot-states/`:
    - Each slot state screenshot: Label the specific slot type shown, its CSS class, and its interactive behavior (clickable vs disabled)

    For `03-booking-flow/`:
    - Sequential step labels: "Step 1: Slot clicked, panel opens", "Step 2: User selected via button or hotkey", "Step 3: Duration selected = booking confirmed"

    For `04-book-now-button/`:
    - Visible state: "Book Now [B] — pulses when current hour is available"
    - Hidden state: "Book Now hidden — current hour booked/past/outside hours"

    For `05-timezone-toggle/`:
    - QLD: "Timezone Toggle [T] — QLD (default, no offset)"
    - NSW: "Timezone Toggle [T] — NSW +1h (during DST)", "Time labels shifted +1 hour"

    For `06-responsive/`:
    - Mobile: "Mobile Layout (375px) — stacked, full-width slots", "Panel Overlay — dark backdrop on mobile"
    - Tablet: "Tablet Layout (768px) — intermediate sizing"

    **Important:** Read the SUMMARY from Plan 01 to know exactly which screenshots were captured and their filenames. Adapt the annotation map to match the ACTUAL files that exist (not just the planned filenames).

    **Script execution:**
    - Scan all subdirectories 01-06 for PNG files
    - For each file, look up its annotation map
    - If annotations defined: create annotated version in `07-annotated/{original-dir-prefix}-{filename}`
    - If no annotations defined (unexpected file): copy to 07-annotated unchanged, log warning
    - Use Sharp: read image -> get metadata for dimensions -> create SVG overlay with all labels -> composite -> write to output

    **SVG overlay template for each label:**
    ```svg
    <rect x="{x-5}" y="{y-22}" width="{textWidth+10}" height="28" rx="4" fill="rgba(0,0,0,0.75)" />
    <text x="{x}" y="{y}" font-family="Arial" font-size="18" font-weight="bold" fill="#FF0000">{text}</text>
    ```

    Estimate text width as `text.length * 9` (rough approximation for 18px Arial).

    Run the script:
    ```
    node .planning/phases/05-visual-capture/scripts/annotate.mjs
    ```

    Verify all output files exist and are valid images (>10KB).
  </action>
  <verify>
    - `ls .planning/phases/05-visual-capture/screenshots/07-annotated/*.png | wc -l` matches total raw screenshots count
    - Each annotated file is larger than its raw counterpart (added SVG overlay increases size)
    - `node .planning/phases/05-visual-capture/scripts/annotate.mjs` exits with code 0
    - No warnings about missing annotation definitions in the output log
  </verify>
  <done>Every raw screenshot has a corresponding annotated version in 07-annotated/ with red text labels on semi-transparent backgrounds identifying all interactive elements and their states.</done>
</task>

<task type="auto">
  <name>Task 2: Create screenshot manifest document</name>
  <files>
    .planning/phases/05-visual-capture/SCREENSHOT-MANIFEST.md
  </files>
  <action>
    Create `SCREENSHOT-MANIFEST.md` — the definitive index of all captured screenshots. This document is what Phase 7 (UI/UX Documentation) and Phase 10 (Master Spec Assembly) will reference.

    **Structure:**

    ```markdown
    # Visual Capture Manifest

    ## Overview
    Total screenshots: {N} raw + {N} annotated
    Captured from: https://booking-bmo-financial-solutions.vercel.app
    Capture date: {date}
    Viewport: 1440x900 (desktop default)

    ## Requirements Coverage

    | Req ID | Requirement | Screenshots | Status |
    |--------|-------------|-------------|--------|
    | VCAP-01 | Initial load state | 000-initial-load.png | Complete |
    | VCAP-02 | Date selected + time grid | 001-empty-calendar.png, 002-... | Complete |
    | ... | ... | ... | ... |

    ## Screenshot Index

    ### 01-initial-states/
    | File | Requirement | Description | Key Elements |
    |------|-------------|-------------|--------------|
    | 000-initial-load.png | VCAP-01 | App initial load, today's date, time slots visible | Header, TimeStrip, available slots |
    | ... | ... | ... | ... |

    ### 02-slot-states/
    ... (same table format)

    ... (all 6 directories + 07-annotated)

    ## Capture Notes
    - {Any notes about time-of-day limitations}
    - {Any states that couldn't be captured and why}
    - {Bookings created during capture that may appear in screenshots}
    ```

    Read the actual screenshot directories to build this manifest from reality (not assumptions). List every file that exists.

    For each screenshot, include:
    - **File**: exact filename
    - **Requirement**: VCAP-XX ID it satisfies
    - **Description**: what the screenshot shows (2-3 sentences)
    - **Key Elements**: CSS classes/component names visible (helps the AI consumer map visual to code)
  </action>
  <verify>
    - `SCREENSHOT-MANIFEST.md` exists and is >1KB
    - Every PNG file in screenshots/ directories is listed in the manifest
    - All 8 VCAP requirements (VCAP-01 through VCAP-08) appear in the coverage table
    - No "TBD" or placeholder entries remain
  </verify>
  <done>SCREENSHOT-MANIFEST.md exists with complete index of all screenshots, requirement coverage matrix showing all VCAP requirements addressed, and descriptions of each image with key UI elements identified.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete visual capture of the deployed booking form:
    - Raw screenshots in 6 organized directories (VCAP-01 through VCAP-07)
    - Annotated screenshots with red text labels in 07-annotated/ (VCAP-08)
    - Screenshot manifest document mapping every image to its requirement

    All images captured from the live site at https://booking-bmo-financial-solutions.vercel.app
  </what-built>
  <how-to-verify>
    1. Open a few raw screenshots from different categories to confirm they show the actual booking app (not blank/error pages):
       - `open ".planning/phases/05-visual-capture/screenshots/01-initial-states/"` (check initial load)
       - `open ".planning/phases/05-visual-capture/screenshots/02-slot-states/"` (check slot states are distinguishable)
       - `open ".planning/phases/05-visual-capture/screenshots/03-booking-flow/"` (check booking panel steps)
    2. Open 2-3 annotated screenshots from `07-annotated/` and verify:
       - Red text labels are readable against the dark theme
       - Labels accurately identify the UI elements
       - Labels don't obscure critical parts of the interface
    3. Review `SCREENSHOT-MANIFEST.md` and confirm:
       - All 8 VCAP requirements show "Complete" status
       - Descriptions make sense for what each screenshot shows
    4. Compare a few screenshots against the live site (visit https://booking-bmo-financial-solutions.vercel.app) to confirm visual accuracy
  </how-to-verify>
  <resume-signal>Type "approved" if screenshots are accurate and well-annotated, or describe specific issues (e.g., "annotations overlap the booking panel", "missing mobile view screenshot", "timezone toggle not captured correctly")</resume-signal>
</task>

</tasks>

<verification>
1. All 7 screenshot directories (01 through 07) contain PNG files
2. Annotated directory (07) has same count as combined raw directories (01-06)
3. SCREENSHOT-MANIFEST.md lists every file with requirement mapping
4. Coverage table shows all 8 VCAP requirements addressed
5. No PNG file is empty (0 bytes) or oversized (>5MB)
6. Both scripts (capture-all.mjs, annotate.mjs) run without errors
7. Human visual verification confirms accuracy
</verification>

<success_criteria>
- All VCAP-01 through VCAP-08 requirements satisfied
- At least 15 unique screenshots captured across 6 categories
- Every screenshot has an annotated counterpart with readable labels
- SCREENSHOT-MANIFEST.md provides complete structured index
- Human has verified visual accuracy and annotation quality
</success_criteria>

<output>
After completion, create `.planning/phases/05-visual-capture/05-02-SUMMARY.md`
</output>
