---
phase: 04-deployment
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: false

must_haves:
  truths:
    - "All changes from Phases 1-3 are on template repo main branch"
    - "4 admin instances show updated code (time slot fix, Book Now, timezone toggle)"
    - "booking-eureka instance shows updated code (same features as admin instances)"
  artifacts:
    - path: "remote: template main branch"
      provides: "All milestone code changes"
      contains: "Phase 1-3 commits"
    - path: "remote: eureka main branch"
      provides: "Synced milestone code changes"
      contains: "Same files as template"
  key_links:
    - from: "template repo main"
      to: "Vercel auto-deploy"
      via: "git push triggers deploy"
      pattern: "git push origin main"
    - from: "template repo"
      to: "eureka repo"
      via: "manual file copy"
      pattern: "cp src/ files"
---

<objective>
Deploy all milestone changes to all 5 booking calendar instances.

Purpose: Users across all instances get the time slot fix, Book Now button, and timezone toggle.

Output: All 5 Vercel deployments updated with Phase 1-3 code changes.
</objective>

<execution_context>
@/Users/clintonweekes/.claude/get-shit-done/workflows/execute-plan.md
@/Users/clintonweekes/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-deployment/04-RESEARCH.md

**Deployment Architecture:**
- Template repo: `boydclinton82/cps-calendar-book-form` (this codebase)
- 4 admin instances auto-deploy via Vercel git integration on push to main
- 1 eureka instance: separate repo `boydclinton82/eureka-whittaker-macnaught-booking` at `/Users/clintonweekes/Library/Mobile Documents/com~apple~CloudDocs/Documents/Software/cps-calendar-dual`

**Files Changed This Milestone (Phase 1-3):**
- src/utils/time.js (Phase 1 + 3)
- src/App.jsx (Phase 2 + 3)
- src/components/Header.jsx (Phase 2 + 3)
- src/components/Header.css (Phase 2 + 3)
- src/utils/storage.js (Phase 3)
- src/components/TimeStrip.jsx (Phase 3)
- src/components/TimeSlot.jsx (Phase 3)
- src/components/WeekView.jsx (Phase 3)
- src/components/BookingPanel.jsx (Phase 3)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Push template repo and verify admin deploys</name>
  <files>N/A (git operations only)</files>
  <action>
1. Confirm we're on main branch and all changes are committed:
```bash
cd "/Users/clintonweekes/Library/Mobile Documents/com~apple~CloudDocs/Documents/Software/cps-calendar-book-form"
git status
git log --oneline -5
```

2. Identify all files changed since milestone start (Phase 1-3):
```bash
git diff --name-only HEAD~10 HEAD -- src/
```

3. Push to origin main to trigger auto-deploy to 4 admin instances:
```bash
git push origin main
```

4. Wait 60 seconds for Vercel deployments to complete.

5. Verify deployments by checking each admin instance responds:
```bash
curl -s -o /dev/null -w "%{http_code}" https://booking-bmo-financial-solutions.vercel.app
curl -s -o /dev/null -w "%{http_code}" https://booking-eclipse.vercel.app
curl -s -o /dev/null -w "%{http_code}" https://booking-nestworth.vercel.app
curl -s -o /dev/null -w "%{http_code}" https://booking-insight.vercel.app
```

All should return 200.
  </action>
  <verify>
`git push` succeeds. All 4 curl commands return 200.
  </verify>
  <done>
Template repo pushed to main. 4 admin instances auto-deployed and responding.
  </done>
</task>

<task type="auto">
  <name>Task 2: Sync changed files to eureka repo and push</name>
  <files>N/A (file copy to external repo)</files>
  <action>
**Define paths:**
```bash
TEMPLATE="/Users/clintonweekes/Library/Mobile Documents/com~apple~CloudDocs/Documents/Software/cps-calendar-book-form"
EUREKA="/Users/clintonweekes/Library/Mobile Documents/com~apple~CloudDocs/Documents/Software/cps-calendar-dual"
```

**Copy all changed files from template to eureka:**
```bash
cp "$TEMPLATE/src/utils/time.js" "$EUREKA/src/utils/time.js"
cp "$TEMPLATE/src/utils/storage.js" "$EUREKA/src/utils/storage.js"
cp "$TEMPLATE/src/App.jsx" "$EUREKA/src/App.jsx"
cp "$TEMPLATE/src/components/Header.jsx" "$EUREKA/src/components/Header.jsx"
cp "$TEMPLATE/src/components/Header.css" "$EUREKA/src/components/Header.css"
cp "$TEMPLATE/src/components/TimeStrip.jsx" "$EUREKA/src/components/TimeStrip.jsx"
cp "$TEMPLATE/src/components/TimeSlot.jsx" "$EUREKA/src/components/TimeSlot.jsx"
cp "$TEMPLATE/src/components/WeekView.jsx" "$EUREKA/src/components/WeekView.jsx"
cp "$TEMPLATE/src/components/BookingPanel.jsx" "$EUREKA/src/components/BookingPanel.jsx"
```

**Commit and push eureka repo:**
```bash
cd "$EUREKA"
git status
git add -A
git commit -m "Sync: Universal Booking Improvements (Phases 1-3)

- Fix current hour slot visibility (isSlotPast uses END time)
- Add Book Now button for instant current-hour booking
- Add NSW timezone toggle with DST detection

Synced from boydclinton82/cps-calendar-book-form

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>"
git push origin main
```

**Wait for eureka deployment and verify:**
```bash
sleep 60
curl -s -o /dev/null -w "%{http_code}" https://booking-eureka.vercel.app
```

Should return 200.
  </action>
  <verify>
All 9 files copied. `git push` succeeds for eureka repo. Curl returns 200.
  </verify>
  <done>
Eureka repo synced with all Phase 1-3 changes and deployed.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Deployed all milestone changes to all 5 booking instances (4 admin + 1 eureka)</what-built>
  <how-to-verify>
Visit each deployment and verify the three features work:

**Test on ONE admin instance (e.g., booking-eclipse.vercel.app):**
1. **Time Slot Fix:** Check that current hour slot is visible and bookable (if before end of hour)
2. **Book Now:** If current hour available, "Book Now" button visible in header with pulse glow
3. **Timezone Toggle:** Click "[T] QLD" button in header - should toggle to "NSW +1h" (or +0h if not DST)
4. Refresh page - timezone toggle state persists

**Test on eureka (booking-eureka.vercel.app):**
1. Same three features work identically
2. Timezone toggle persists across refresh

**URLs:**
- https://booking-bmo-financial-solutions.vercel.app
- https://booking-eclipse.vercel.app
- https://booking-nestworth.vercel.app
- https://booking-insight.vercel.app
- https://booking-eureka.vercel.app
  </how-to-verify>
  <resume-signal>Type "approved" if all 5 instances show the new features, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. Template repo: `git push` completed without errors
2. Admin instances: All 4 return HTTP 200
3. Eureka repo: `git push` completed without errors
4. Eureka instance: Returns HTTP 200
5. Feature verification: Time slot fix, Book Now, and timezone toggle work on all instances
6. Persistence: Timezone preference persists in localStorage on each instance
</verification>

<success_criteria>
- DEPL-01: Changes pushed to template repo, 4 admin instances auto-deployed
- DEPL-02: Changed files synced to booking-eureka repo and pushed
- All 5 instances show: time slot fix, Book Now button, timezone toggle
- No regressions: existing bookings still work
</success_criteria>

<output>
After completion, create `.planning/phases/04-deployment/04-01-SUMMARY.md`
</output>
