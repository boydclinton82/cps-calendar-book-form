---
phase: 10-master-spec-assembly
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/10-master-spec-assembly/SYSTEM-SUMMARY.md
  - .planning/phases/10-master-spec-assembly/SPEC.md
autonomous: true

must_haves:
  truths:
    - "SPEC.md exists and provides clear navigation for Rails Claude to find any spec document"
    - "SPEC.md includes build instructions organized as implementation milestones"
    - "SPEC.md includes three-tier boundary system (Always do / Ask first / Never do)"
    - "SYSTEM-SUMMARY.md covers all features without React-specific terminology"
    - "Directory navigation map accurately lists every Phase 5-9 deliverable file"
    - "Reading order is explicit and numbered (not implied)"
  artifacts:
    - path: ".planning/phases/10-master-spec-assembly/SYSTEM-SUMMARY.md"
      provides: "Technology-neutral feature and behavior summary"
      contains: "booking creation|conflict prevention|multi-hour|timezone|polling"
    - path: ".planning/phases/10-master-spec-assembly/SPEC.md"
      provides: "Master entry point with navigation, build instructions, boundaries"
      contains: "How to Use This Spec|Build Instructions|Boundaries"
  key_links:
    - from: "SPEC.md"
      to: "SYSTEM-SUMMARY.md"
      via: "explicit reference in reading order"
      pattern: "SYSTEM-SUMMARY"
    - from: "SPEC.md"
      to: "phases/05-visual-capture/SCREENSHOT-MANIFEST.md"
      via: "directory navigation map"
      pattern: "SCREENSHOT-MANIFEST"
    - from: "SPEC.md"
      to: "phases/09-functional-documentation/BOOKING-FLOW.md"
      via: "directory navigation map"
      pattern: "BOOKING-FLOW"
    - from: "SPEC.md"
      to: "phases/08-architecture-documentation/API-CONTRACTS.md"
      via: "directory navigation map and cross-reference table"
      pattern: "API-CONTRACTS"
---

<objective>
Create the master specification package: SYSTEM-SUMMARY.md (technology-neutral feature overview) and SPEC.md (AI-consumable entry point with navigation, build instructions, and boundaries).

Purpose: These two documents complete the v2.0 spec package. SPEC.md is the single file Rails Claude reads first -- it provides navigation to all 20+ spec documents across Phases 5-9. SYSTEM-SUMMARY.md gives Rails Claude a complete mental model of the system before diving into detailed specs.

Output: Two markdown files in the Phase 10 directory that, combined with Phase 5-9 deliverables, form a complete AI-consumable specification package.
</objective>

<execution_context>
@/Users/clintonweekes/.claude/get-shit-done/workflows/execute-plan.md
@/Users/clintonweekes/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-master-spec-assembly/10-RESEARCH.md

# Source materials -- read these to synthesize accurate content
@.planning/phases/05-visual-capture/SCREENSHOT-MANIFEST.md
@.planning/phases/06-code-extraction/FILE-MANIFEST.md
@.planning/phases/06-code-extraction/ANNOTATIONS.md
@.planning/phases/07-ui-ux-documentation/LAYOUT-STRUCTURE.md
@.planning/phases/07-ui-ux-documentation/DESIGN-TOKENS.md
@.planning/phases/07-ui-ux-documentation/COMPONENT-STATES.md
@.planning/phases/07-ui-ux-documentation/KEYBOARD-SHORTCUTS.md
@.planning/phases/07-ui-ux-documentation/RESPONSIVE-BEHAVIOR.md
@.planning/phases/07-ui-ux-documentation/ANIMATIONS.md
@.planning/phases/08-architecture-documentation/DATA-STORAGE.md
@.planning/phases/08-architecture-documentation/INSTANCE-CONFIG.md
@.planning/phases/08-architecture-documentation/API-CONTRACTS.md
@.planning/phases/08-architecture-documentation/POLLING-SYNC.md
@.planning/phases/08-architecture-documentation/STATE-MANAGEMENT.md
@.planning/phases/09-functional-documentation/BOOKING-FLOW.md
@.planning/phases/09-functional-documentation/BOOK-NOW-FEATURE.md
@.planning/phases/09-functional-documentation/TIMEZONE-TOGGLE.md
@.planning/phases/09-functional-documentation/TIME-DATE-HANDLING.md
@.planning/phases/09-functional-documentation/EDGE-CASES.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SYSTEM-SUMMARY.md -- technology-neutral feature and behavior overview</name>
  <files>.planning/phases/10-master-spec-assembly/SYSTEM-SUMMARY.md</files>
  <action>
Create a technology-neutral system summary that covers ALL features and behaviors of the booking form. This is SPEC-03.

**Structure the document as follows:**

1. **What This System Does** -- One paragraph overview, then 5-6 bullet points of core capabilities (display availability, prevent conflicts, multi-hour bookings, real-time sync, keyboard-driven interaction, timezone display toggle)

2. **Key Behaviors** -- Subsections for each major behavior, using abstract terminology ("system", "user", "application" -- NOT React/Rails terms):
   - Booking Creation (full flow from slot click to persistence)
   - Booking Editing (change user or duration on existing booking)
   - Booking Deletion (remove existing booking)
   - Conflict Prevention (what checks run and when)
   - Multi-Hour Blocking (algorithm: booking at H with duration D blocks H+1 through H+D-1)
   - Book Now / Quick Booking (header button, current hour auto-selection)
   - Timezone Toggle (QLD default, NSW offset, display-only, DST detection via IANA)
   - Real-Time Sync (polling interval, optimistic updates, conflict resolution)
   - Past Slot Detection (end-of-hour boundary rule, hourly refresh timer)

3. **Data Model** -- Technology-neutral data structures:
   - Bookings storage shape (nested date > time > booking object)
   - Booking object fields (user: string, duration: integer 1-8)
   - Constraints (user must match config, duration bounds, conflict rules)
   - Configuration shape (users list, operating hours, instance identity)

4. **User Experience Flows** -- The three primary flows:
   - Quick booking (Book Now)
   - Normal booking (click slot)
   - Edit/delete booking (click existing)

5. **Interaction Modes** -- Three mutually exclusive modes:
   - NAVIGATION (browse, select)
   - PANEL (creating new booking)
   - POPUP (editing existing booking)
   - Mode transition rules (what triggers each, what exits each)

6. **Edge Cases Handled** -- Summary of the 9 edge case categories from EDGE-CASES.md with count (41 total scenarios). Do NOT duplicate the full edge case list -- just reference the categories and point to EDGE-CASES.md for details.

7. **Technology Constraints** -- What MUST be preserved vs what CAN be adapted:
   - Must preserve: exact booking rules, interaction flows, visual states, time handling logic
   - Can adapt: implementation language, storage backend, polling mechanism, UI framework

**Critical rules:**
- Use ONLY abstract terminology. Never say "useState", "useEffect", "component", "hook", "Redux", "React", "Vercel KV". Say "system", "application", "user interface", "storage", "state".
- Every behavior description must come from Phase 8 or Phase 9 documentation -- do NOT invent behaviors.
- Include cross-references: "See BOOKING-FLOW.md for decision tables" or "See EDGE-CASES.md for full enumeration".
- Use the research template in 10-RESEARCH.md (under "Technology-Neutral System Summary") as a starting point, but expand it with the full detail from Phase 8-9 docs.
  </action>
  <verify>
Verify the document:
1. `grep -c "React\|useState\|useEffect\|component\|hook\|Redux\|Vercel KV" SYSTEM-SUMMARY.md` returns 0 (no technology-specific terms in behavior sections)
2. Document contains all 9 behavior subsections listed above
3. Document references EDGE-CASES.md, BOOKING-FLOW.md, API-CONTRACTS.md, DATA-STORAGE.md
4. Data model section matches the structure documented in DATA-STORAGE.md
  </verify>
  <done>
SYSTEM-SUMMARY.md exists with complete technology-neutral coverage of all features, behaviors, data model, interaction modes, and edge case categories. Zero React-specific terminology in behavior descriptions. Cross-references point to detailed Phase 8-9 spec documents.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create SPEC.md -- master entry point with navigation, build instructions, and boundaries</name>
  <files>.planning/phases/10-master-spec-assembly/SPEC.md</files>
  <action>
Create the master SPEC.md entry point document. This is the FIRST file Rails Claude reads. It is SPEC-01 and SPEC-02 combined.

**Structure the document as follows:**

1. **Header block:**
   ```
   # BMO Financial Booking System -- Specification
   Version: 2.0
   Last Updated: 2026-02-13
   Target Consumer: Claude Code (Rails implementation)
   Source Truth: https://booking-bmo-financial-solutions.vercel.app
   ```

2. **Overview** -- 2-3 sentences on what this system is. State the core value: "Another Claude Code instance can perfectly recreate this booking form from this spec alone."

3. **How to Use This Spec** (SPEC-02):
   - **First Time Reading** -- Numbered reading order (1-7):
     1. Start here (SPEC.md)
     2. Read SYSTEM-SUMMARY.md for full mental model
     3. Study Phase 05 screenshots to see what you are building
     4. Read Phase 09 functional specs for behavior rules
     5. Read Phase 08 architecture specs for data flow and API contracts
     6. Read Phase 07 UI/UX specs for visual/interaction details
     7. Reference Phase 06 code extraction for React implementation patterns (adapt, do not port)
   - **During Implementation** -- Task-specific navigation table:
     - For API work: start with API-CONTRACTS.md
     - For UI work: start with LAYOUT-STRUCTURE.md, reference screenshots
     - For business logic: start with BOOKING-FLOW.md, reference EDGE-CASES.md
     - For data modeling: start with DATA-STORAGE.md
     - For keyboard shortcuts: KEYBOARD-SHORTCUTS.md
     - For styling: DESIGN-TOKENS.md, COMPONENT-STATES.md
   - **Document Hierarchy** -- Source of truth rules:
     - Visuals: Phase 05 screenshots (annotated versions)
     - Behavior: Phase 09 functional specs
     - Data: Phase 08 architecture specs + Phase 06 data structures
     - Reference only: Phase 06 React code (understand patterns, do not port syntax)
   - **Conflict Resolution** -- When specs seem to disagree:
     - Screenshots trump text for visual details
     - Functional specs trump code for behavior
     - Architecture specs trump code for data structures

4. **Specification Package Contents** (SPEC-02 directory structure):
   Create a complete directory navigation map listing EVERY deliverable file from Phases 5-9 plus Phase 10. Use the format from the research (table with File, Contents, Read When columns). Organize by phase. Include:
   - Phase 10: SPEC.md, SYSTEM-SUMMARY.md
   - Phase 05: SCREENSHOT-MANIFEST.md, all 7 screenshot subdirectories
   - Phase 06: FILE-MANIFEST.md, ANNOTATIONS.md, DEPENDENCIES.json, extracted-code/
   - Phase 07: All 6 docs (LAYOUT-STRUCTURE, DESIGN-TOKENS, COMPONENT-STATES, KEYBOARD-SHORTCUTS, RESPONSIVE-BEHAVIOR, ANIMATIONS)
   - Phase 08: All 5 docs (DATA-STORAGE, INSTANCE-CONFIG, API-CONTRACTS, POLLING-SYNC, STATE-MANAGEMENT)
   - Phase 09: All 5 docs (BOOKING-FLOW, BOOK-NOW-FEATURE, TIMEZONE-TOGGLE, TIME-DATE-HANDLING, EDGE-CASES)

   Also include the cross-reference table from the research: "When Working On... | Primary Docs | Supporting Docs"

5. **Build Instructions** (SPEC-01):
   Organize as implementation milestones for Rails Claude. Suggest this order:
   - Milestone 1: Data model and storage (DATA-STORAGE.md, INSTANCE-CONFIG.md)
   - Milestone 2: API endpoints (API-CONTRACTS.md)
   - Milestone 3: Core booking logic (BOOKING-FLOW.md, EDGE-CASES.md, TIME-DATE-HANDLING.md)
   - Milestone 4: UI layout and styling (LAYOUT-STRUCTURE.md, DESIGN-TOKENS.md, screenshots)
   - Milestone 5: Interactive states and keyboard (COMPONENT-STATES.md, KEYBOARD-SHORTCUTS.md, ANIMATIONS.md)
   - Milestone 6: Features (BOOK-NOW-FEATURE.md, TIMEZONE-TOGGLE.md)
   - Milestone 7: Real-time sync (POLLING-SYNC.md, STATE-MANAGEMENT.md)
   - Milestone 8: Responsive and polish (RESPONSIVE-BEHAVIOR.md, visual QA against screenshots)

   For each milestone, list: what to read, what to build, and acceptance criteria (observable behavior).

6. **Boundaries** -- Three-tier system from research:
   - Always Do (create models/controllers/services/views, add tests, use Rails conventions, commit working features)
   - Ask First (change API contracts, modify core business rules, change data storage structure, add dependencies)
   - Never Do (commit secrets, skip tests for booking operations, change technology-neutral behavior specs, implement features not in scope, force push to main)

7. **Technology Stack** -- Required and optional:
   - Required: Rails 7.x+, Ruby 3.x+, relational DB (PostgreSQL recommended), key-value store (Redis recommended)
   - Optional: background job processor, API testing framework

8. **Success Criteria** -- Checklist for implementation completion:
   - All Phase 09 functional requirements implemented
   - All Phase 08 API contracts satisfied
   - Visual appearance matches Phase 05 screenshots
   - All 41 edge cases from EDGE-CASES.md handled
   - Test coverage >90% for booking operations
   - Deployed version behaves identically to reference app

9. **Questions During Implementation** -- Resolution guidance:
   - Missing detail: update spec with question + answer
   - Unclear requirement: check functional specs first, screenshots second, code third
   - Conflicting info: screenshots trump text for visuals, functional specs trump code for behavior
   - Out of scope feature: ask human before implementing

**Critical rules:**
- All file paths must be RELATIVE to `.planning/` directory (since SPEC.md lives in `.planning/phases/10-master-spec-assembly/`)
- Use relative paths from SPEC.md location: `../05-visual-capture/SCREENSHOT-MANIFEST.md` etc.
- Actually, use paths relative to `.planning/phases/` since that is the common root for all phase directories. State the path convention clearly at the top of the directory map section.
- Build instructions must reference specific spec documents by name, not vague descriptions
- The document should be self-contained enough that Rails Claude knows exactly what to do after reading SPEC.md + SYSTEM-SUMMARY.md
  </action>
  <verify>
Verify the document:
1. SPEC.md contains all 9 sections listed above
2. Directory navigation map lists every file: count files referenced vs actual files in phases 05-09 directories
3. Build instructions reference specific doc names (not vague "read the specs")
4. Three-tier boundary system present with concrete examples in each tier
5. "How to Use This Spec" has numbered reading order
6. Cross-reference table present ("When Working On...")
7. All file paths are valid relative references (spot-check 3-4 paths)
  </verify>
  <done>
SPEC.md exists as a complete AI-consumable entry point with: numbered reading order, directory navigation map covering all Phase 5-9 deliverables, milestone-based build instructions, three-tier boundary system, technology stack requirements, success criteria checklist, and conflict resolution rules. Rails Claude can navigate the entire spec package from this single document.
  </done>
</task>

</tasks>

<verification>
Phase-level verification after both tasks:

1. **Navigation completeness:** Every file in phases/05-09 directories is referenced in SPEC.md directory map
2. **Technology neutrality:** SYSTEM-SUMMARY.md contains zero React/framework-specific terms in behavior sections
3. **Cross-referencing:** SPEC.md links to SYSTEM-SUMMARY.md; SYSTEM-SUMMARY.md links to Phase 8-9 detail docs
4. **Build instructions:** Each milestone references specific spec documents by exact filename
5. **Requirements coverage:**
   - SPEC-01: SPEC.md has build instructions (check)
   - SPEC-02: SPEC.md has directory structure + "how to use" guide (check)
   - SPEC-03: SYSTEM-SUMMARY.md covers all features and behaviors (check)
</verification>

<success_criteria>
1. SPEC.md exists and a Rails Claude instance reading it would know exactly: what to build, in what order, where to find every detail, and what boundaries to respect
2. SYSTEM-SUMMARY.md exists and provides a complete mental model of the system without any React-specific terminology
3. Together, these two files + the Phase 5-9 deliverables form a complete specification package
4. All three requirements (SPEC-01, SPEC-02, SPEC-03) are satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/10-master-spec-assembly/10-01-SUMMARY.md`
</output>
