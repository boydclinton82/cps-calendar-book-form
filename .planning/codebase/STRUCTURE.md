# Codebase Structure

**Analysis Date:** 2026-02-04

## Directory Layout

```
cps-calendar-book-form/
├── src/                    # Frontend React application
│   ├── main.jsx            # React root entry point
│   ├── App.jsx             # Main app component with state management
│   ├── App.css             # App-level styles
│   ├── index.css           # Global styles
│   ├── components/         # Reusable React components
│   ├── context/            # React Context providers
│   ├── hooks/              # Custom React hooks
│   ├── services/           # API client layer
│   └── utils/              # Pure utility functions
├── api/                    # Vercel serverless backend functions
│   ├── bookings/           # Booking CRUD endpoints
│   └── _lib/               # Shared API utilities (security, validation)
├── public/                 # Static assets
├── dist/                   # Built output (generated by Vite)
├── docs/                   # Project documentation
├── scripts/                # Development/deployment scripts
├── .env.local              # Local environment variables (gitignored)
├── .env.production         # Production environment variables
├── package.json            # Node.js dependencies and scripts
├── vite.config.js          # Vite build configuration
├── vercel.json             # Vercel deployment configuration
└── index.html              # HTML entry point
```

## Directory Purposes

**`src/`:**
- Purpose: All frontend React code
- Contains: Components, state management, utilities, services, context
- Key files: `main.jsx` (entry), `App.jsx` (state root)

**`src/components/`:**
- Purpose: Reusable React UI components
- Contains: Functional components with JSX, paired CSS files
- Key files:
  - `Header.jsx` - Top bar with title, date navigation, week/day toggle
  - `TimeStrip.jsx` - Renders day view with time slots and booking overlay
  - `TimeSlot.jsx` - Individual 1-hour slot in day view (clickable)
  - `BookingOverlay.jsx` - Positioned bookings overlaid on time strip
  - `BookingBlock.jsx` - Single multi-hour booking display with cancel/edit button
  - `BookingPanel.jsx` - Right-side modal for creating booking (user + duration selection)
  - `BookingPopup.jsx` - Modal for editing existing booking
  - `WeekView.jsx` - 7-day week grid view
  - `WeekBookingBlock.jsx` - Booking display in week view
  - `WeekDayOverlay.jsx` - Day cell in week view with day select and bookings

**`src/context/`:**
- Purpose: React Context providers for shared state
- Contains: ConfigContext setup and provider component
- Key files: `ConfigContext.jsx` - Provides config, loading, error state to entire app

**`src/hooks/`:**
- Purpose: Custom React hooks for state and side effects
- Contains: Hooks for bookings, config, keyboard, polling, refresh
- Key files:
  - `useBookings.js` - Booking CRUD operations, slot status checking, conflict validation
  - `useConfig.js` - Hook to access ConfigContext (with error boundary)
  - `useKeyboard.js` - Keyboard event handling for hotkeys
  - `usePollingSync.js` - Real-time sync via polling when API enabled
  - `useHourlyRefresh.js` - Refresh bookings every hour to update past slots

**`src/services/`:**
- Purpose: Client-side API communication abstraction
- Contains: Fetch wrapper with localStorage fallback
- Key files: `api.js` - Handles all HTTP requests, falls back to localStorage when API unavailable

**`src/utils/`:**
- Purpose: Pure utility functions without side effects
- Contains: Date/time helpers, color utilities, storage operations
- Key files:
  - `time.js` - Time slot generation, date formatting, multi-hour booking logic
  - `colors.js` - User color assignment (for UI display)
  - `storage.js` - localStorage CRUD operations (backup persistence layer)

**`api/`:**
- Purpose: Vercel serverless functions (backend)
- Contains: HTTP request handlers for REST endpoints
- Deployment: Each `.js` file in `api/` becomes a serverless function

**`api/bookings/`:**
- Purpose: Booking resource endpoints
- Contains: index.js (GET all, POST create), update.js (PUT update, DELETE delete)
- Key files:
  - `api/bookings/index.js` - GET `/api/bookings` (fetch all), POST `/api/bookings` (create)
  - `api/bookings/update.js` - PUT `/api/bookings/update` (update), DELETE (delete)

**`api/_lib/`:**
- Purpose: Shared utilities for API handlers
- Contains: Security middleware, input sanitization, rate limiting
- Key files: `api/_lib/security.js` - CORS handling, rate limiter, input sanitization, security headers

**`public/`:**
- Purpose: Static assets served as-is
- Contains: Images, favicons, etc.
- Key files: `vite.svg` - Placeholder image

**`dist/`:**
- Purpose: Built frontend output (generated)
- Contains: Minified JS, CSS, HTML
- Note: Generated by `npm run build`, not committed to git

**`docs/`:**
- Purpose: Project documentation and planning
- Contains: Architecture decisions, phase plans, research notes
- Not code: For human reference only

**`scripts/`:**
- Purpose: Development and deployment helper scripts
- Key files: `seed-kv.mjs` - Script to initialize KV store with test data

## Key File Locations

**Entry Points:**
- `index.html`: Browser requests this file, loads React app
- `src/main.jsx`: React root, mounts App component with ConfigProvider
- `src/App.jsx`: State root, orchestrates all hooks and components

**Configuration:**
- `.env.local`: Local dev environment (API_ENDPOINT, VITE_USE_API flag)
- `.env.production`: Production environment (for Vercel deployment)
- `vercel.json`: Defines serverless function memory/timeout, rewrites for SPA

**Core Logic:**
- `src/hooks/useBookings.js`: All booking state and CRUD operations
- `src/services/api.js`: HTTP abstraction with fallback logic
- `src/utils/time.js`: Time slot math, multi-hour logic, blocking logic
- `api/bookings/index.js`: GET/POST handlers for bookings
- `api/bookings/update.js`: PUT/DELETE handlers for bookings

**Testing:**
- No test files present in current structure
- Manual testing only

## Naming Conventions

**Files:**
- Components: PascalCase, `.jsx` extension (e.g., `TimeSlot.jsx`)
- Hooks: camelCase with `use` prefix, `.js` extension (e.g., `useBookings.js`)
- Utilities: camelCase, `.js` extension (e.g., `time.js`)
- API handlers: same name as route path (e.g., `bookings/index.js` → `/api/bookings`)
- Styles: same name as component, `.css` extension (e.g., `TimeSlot.css`)

**Functions:**
- Component functions: PascalCase (e.g., `TimeSlot`, `BookingPanel`)
- Hook functions: camelCase with `use` prefix (e.g., `useBookings`, `useKeyboard`)
- Utility/helper functions: camelCase (e.g., `formatDate`, `isSlotBlocked`)
- API handlers: named `handler` (wrapped by security middleware)

**Variables:**
- Constants: SCREAMING_SNAKE_CASE (e.g., `START_HOUR`, `POLLING_INTERVAL`, `TIME_SLOTS`)
- State variables: camelCase (e.g., `bookings`, `selectedSlot`, `currentDate`)
- Event handlers: camelCase with `on` prefix (e.g., `onSlotSelect`, `handleUserSelect`)
- Ref variables: camelCase with `Ref` suffix (e.g., `intervalRef`, `isMountedRef`)

**Type/Data:**
- Time key: `HH:00` format as string (e.g., `"10:00"`)
- Date key: `YYYY-MM-DD` ISO string (e.g., `"2026-02-04"`)
- User key: single lowercase letter or char from config (e.g., `"j"` for Jack)
- Duration: number 1-3 (hours)

**Directories:**
- Plural for collections (`components/`, `hooks/`, `utils/`)
- Singular for singletons (`context/`, `services/`)
- Resource path matches REST endpoint (`bookings/` → `/api/bookings`)

## Where to Add New Code

**New Feature (e.g., user authentication):**
- Primary code: New hook in `src/hooks/` (e.g., `useAuth.js`) + context in `src/context/` if needed
- API endpoint: New file in `api/` (e.g., `api/auth.js` for `/api/auth`)
- Security: Add validation to `api/_lib/security.js` if needed
- Tests: No test framework present; add manual test cases to docs

**New Component (e.g., notification toast):**
- Implementation: New component file in `src/components/` with paired `.css` file
- Props: Accept from parent; avoid tightly coupling to global state
- Integration: Import and render in parent component (likely `App.jsx` or specific container)

**New Utility Function (e.g., booking export):**
- Shared helpers: `src/utils/[feature].js` (create new file by feature area)
- Pure functions: No side effects, accept parameters, return result
- Type hints: Use JSDoc comments for parameter/return documentation

**API Enhancement (e.g., new endpoint for statistics):**
- Handler: Create file in `api/[resource]/[action].js`
- Security: Wrap with `withSecurity(handler)` from `api/_lib/security.js`
- Validation: Use `sanitizeBookingInput()` or create similar sanitizer for new data shape
- Client: Add fetch function to `src/services/api.js`

**Styling:**
- Component styles: Co-located `.css` file with component (e.g., `TimeSlot.css` with `TimeSlot.jsx`)
- Global styles: `src/index.css` (minimal, prefer component-local)
- Do not use CSS frameworks or preprocessors; plain CSS only

**Adding Environment Configuration:**
- Local: Add to `.env.local` (gitignored)
- Production: Add to `.env.production` (for Vercel)
- Usage: Access via `import.meta.env.VITE_*` in frontend, `process.env.*` in API functions
- Document in `.env.local.example`

## Special Directories

**`dist/`:**
- Purpose: Built output from Vite
- Generated: Yes (by `npm run build`)
- Committed: No (in .gitignore)
- Deployment: Contents uploaded to Vercel

**`.vercel/`:**
- Purpose: Vercel configuration and project metadata
- Generated: Partially (by Vercel CLI)
- Committed: Partially (`project.json` tracked, `.env` gitignored)
- Note: Do not manually edit `project.json` unless using Vercel CLI

**`versions/`:**
- Purpose: Historical version branches/snapshots
- Generated: No (manually created)
- Committed: Yes (reference only)
- Note: Not used by current build; legacy reference

**`.planning/`:**
- Purpose: GSD planning documents (this file)
- Generated: Yes (by GSD orchestrator)
- Committed: Per user preference
- Contents: ARCHITECTURE.md, STRUCTURE.md, CONVENTIONS.md, etc.

**`docs/`:**
- Purpose: Project documentation and decision logs
- Generated: Manually
- Committed: Yes
- Contents: Phase plans, research notes, decision logs, not code

---

*Structure analysis: 2026-02-04*
